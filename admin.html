<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast8 Super Admin - All-in-One</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --dark: #0f172a; --primary: #e63946; --success: #10b981; --gray: #64748b; }
        body { font-family: 'Inter', sans-serif; margin: 0; display: flex; background: #f1f5f9; color: #1e293b; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--dark); color: white; height: 100vh; position: fixed; padding: 25px; box-sizing: border-box; }
        .nav-item { padding: 12px; margin: 10px 0; cursor: pointer; border-radius: 8px; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover, .nav-item.active { background: var(--primary); }

        /* Main Content */
        .main { margin-left: 260px; padding: 30px; width: 100%; }
        .section { display: none; animation: fadeIn 0.5s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Cards & Stats */
        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); text-align: center; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }

        /* Forms & Tables */
        input, select { padding: 12px; margin: 8px 0; border: 1px solid #cbd5e1; border-radius: 8px; width: 100%; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 10px; overflow: hidden; }
        th, td { text-align: left; padding: 15px; border-bottom: 1px solid #f1f5f9; }
        th { background: #f8fafc; color: var(--gray); font-size: 13px; text-transform: uppercase; }
        .btn { padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="color: var(--primary);">Fast8 Admin</h2>
    <hr style="opacity: 0.1; margin: 20px 0;">
    <div class="nav-item active" onclick="showSection('dash', this)"><i class="fas fa-home"></i> Dashboard</div>
    <div class="nav-item" onclick="showSection('orders', this)"><i class="fas fa-shopping-cart"></i> Orders</div>
    <div class="nav-item" onclick="showSection('inventory', this)"><i class="fas fa-box"></i> Inventory</div>
    <div class="nav-item" onclick="showSection('riders', this)"><i class="fas fa-motorcycle"></i> Riders</div>
</div>

<div class="main">
    <div id="dash" class="section active">
        <div class="stat-grid">
            <div class="stat-card">Total Sales<br><h2 id="s-total">‚Çπ0</h2></div>
            <div class="stat-card">Total Orders<br><h2 id="s-orders">0</h2></div>
            <div class="stat-card">Rider Payout<br><h2 id="s-rider">‚Çπ0</h2></div>
            <div class="stat-card">Net Profit<br><h2 id="s-profit">‚Çπ0</h2></div>
        </div>
        <div class="card">
            <h3>Recent Orders Overview</h3>
            <div id="recent-orders-list">Loading...</div>
        </div>
    </div>

    <div id="inventory" class="section">
        <div class="card">
            <h3>‚ûï Add New Product</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px;">
                <input type="text" id="pName" placeholder="Product Name">
                <input type="number" id="pPrice" placeholder="Price (‚Çπ)">
                <input type="text" id="pUnit" placeholder="Unit (kg/plate)">
                <select id="pCat">
                    <option value="Grocery">Grocery</option>
                    <option value="Tiffin">Tiffin</option>
                </select>
            </div>
            <button class="btn btn-success" style="width: 100%; margin-top: 15px;" onclick="addProduct()">Add Product to User Panel</button>
        </div>
        <div class="card">
            <h3>Current Inventory</h3>
            <table id="product-table">
                <thead><tr><th>Name</th><th>Category</th><th>Price</th><th>Unit</th><th>Action</th></tr></thead>
                <tbody id="product-body"></tbody>
            </table>
        </div>
    </div>

    <div id="riders" class="section">
        <div class="card">
            <h3>üö¥ Rider Management & Earnings</h3>
            <table id="rider-table">
                <thead><tr><th>Rider Name</th><th>Orders Done</th><th>Total Earning</th><th>Status</th></tr></thead>
                <tbody id="rider-body"></tbody>
            </table>
        </div>
    </div>

    <div id="orders" class="section">
        <div class="card">
            <h3>üìë All Orders History</h3>
            <table id="full-order-table">
                <thead><tr><th>Customer</th><th>Items</th><th>Bill</th><th>Status</th><th>Rider</th><th>Action</th></tr></thead>
                <tbody id="full-order-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Firebase Config (Keep yours same)
    const firebaseConfig = {
        apiKey: "AIzaSyBpRhuVaHqznb9q8YEJP3Pg19MWv5camXE",
        authDomain: "fast8delivery-a90b4.firebaseapp.com",
        projectId: "fast8delivery-a90b4",
        appId: "1:200027434311:web:9bc6caf3db527b602c3062"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function showSection(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    // --- Inventory Logic ---
    function addProduct() {
        const name = document.getElementById('pName').value;
        const price = parseInt(document.getElementById('pPrice').value);
        const unit = document.getElementById('pUnit').value;
        const cat = document.getElementById('pCat').value;
        if(!name || !price) return alert("Fill details");
        db.collection("products").add({ name, price, unit, category: cat }).then(() => {
            alert("Added!"); document.getElementById('pName').value = "";
        });
    }

    db.collection("products").onSnapshot(snap => {
        const tbody = document.getElementById('product-body');
        tbody.innerHTML = "";
        snap.forEach(doc => {
            const p = doc.data();
            tbody.innerHTML += `<tr><td>${p.name}</td><td>${p.category}</td><td>‚Çπ${p.price}</td><td>${p.unit}</td>
            <td><button class="btn" style="color:red;" onclick="deleteData('products','${doc.id}')">Delete</button></td></tr>`;
        });
    });

    // --- Orders & Stats Logic ---
    db.collection("orders").orderBy("timestamp", "desc").onSnapshot(snap => {
        const orderBody = document.getElementById('full-order-body');
        const riderData = {};
        let revenue = 0, payouts = 0, count = 0;
        orderBody.innerHTML = "";

        snap.forEach(doc => {
            const d = doc.data();
            count++;
            revenue += parseInt(d.totalAmount || 0);
            const rPay = parseInt(d.riderEarning || 15);
            if(d.status === "Delivered") payouts += rPay;

            // Rider analytics
            if(d.assignedTo) {
                if(!riderData[d.assignedTo]) riderData[d.assignedTo] = { count: 0, pay: 0 };
                riderData[d.assignedTo].count++;
                if(d.status === "Delivered") riderData[d.assignedTo].pay += rPay;
            }

            orderBody.innerHTML += `<tr>
                <td>${d.customerName}</td><td>${d.items}</td><td>‚Çπ${d.totalAmount}</td>
                <td><span style="color:orange; font-weight:bold;">${d.status}</span></td>
                <td>${d.assignedTo || 'Unassigned'}</td>
                <td><button onclick="deleteData('orders','${doc.id}')">‚ùå</button></td></tr>`;
        });

        // Update Dashboard Stats
        document.getElementById('s-total').innerText = "‚Çπ" + revenue;
        document.getElementById('s-orders').innerText = count;
        document.getElementById('s-rider').innerText = "‚Çπ" + payouts;
        document.getElementById('s-profit').innerText = "‚Çπ" + (revenue - payouts);

        // Update Rider Table
        const rBody = document.getElementById('rider-body');
        rBody.innerHTML = "";
        for(let name in riderData) {
            rBody.innerHTML += `<tr><td>${name}</td><td>${riderData[name].count}</td><td>‚Çπ${riderData[name].pay}</td><td>Active</td></tr>`;
        }
    });

    function deleteData(col, id) { if(confirm("Delete this?")) db.collection(col).doc(id).delete(); }
</script>
</body>
</html>
