<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fast8 Admin Console</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; margin: 0; background: #f4f7f6; }
        .sidebar { width: 240px; background: #1a1a1a; color: white; height: 100vh; padding: 20px; position: fixed; }
        .main { margin-left: 280px; padding: 20px; width: 100%; }
        .card { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input, select { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .stat-box { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat { flex: 1; background: white; padding: 20px; border-radius: 10px; text-align: center; border-bottom: 4px solid #e63946; }
    </style>
</head>
<body>
<div class="sidebar">
    <h2>Fast8 Admin</h2>
    <p onclick="location.reload()" style="cursor:pointer;">üîÑ Refresh Data</p>
</div>
<div class="main">
    <div class="stat-box">
        <div class="stat">Total Sales<br><h2 id="sales">‚Çπ0</h2></div>
        <div class="stat">Company Profit<br><h2 id="profit">‚Çπ0</h2></div>
        <div class="stat">Active Orders<br><h2 id="count">0</h2></div>
    </div>

    <div class="card">
        <h3>Live Orders</h3>
        <table>
            <thead><tr><th>Customer</th><th>Items</th><th>Bill</th><th>Rider Get</th><th>Status</th><th>Assign Rider</th><th>Action</th></tr></thead>
            <tbody id="order-body"></tbody>
        </table>
    </div>

    <div class="card">
        <h3>Add Product Inventory</h3>
        <input type="text" id="pName" placeholder="Product Name">
        <input type="number" id="pPrice" placeholder="Price">
        <select id="pCat"><option value="Grocery">Grocery</option><option value="Tiffin">Tiffin</option></select>
        <button onclick="addProduct()" style="background:green; color:white; padding:10px; border:none; border-radius:5px;">Add Item</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBpRhuVaHqznb9q8YEJP3Pg19MWv5camXE",
        authDomain: "fast8delivery-a90b4.firebaseapp.com",
        projectId: "fast8delivery-a90b4",
        appId: "1:200027434311:web:9bc6caf3db527b602c3062"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function addProduct() {
        const name = document.getElementById('pName').value;
        const price = parseInt(document.getElementById('pPrice').value);
        const cat = document.getElementById('pCat').value;
        db.collection("products").add({ name, price, category: cat }).then(() => alert("Added to Shop!"));
    }

    db.collection("orders").orderBy("timestamp", "desc").onSnapshot(snap => {
        const body = document.getElementById('order-body');
        let sales = 0, count = 0;
        body.innerHTML = "";
        snap.forEach(doc => {
            const d = doc.data();
            sales += (d.totalAmount || 0); 
            count++;
            const riderPay = d.riderEarning || 30;
            
            body.innerHTML += `<tr>
                <td>${d.customerName}<br><small>${d.customerPhone}</small></td>
                <td>${d.items}</td>
                <td>‚Çπ${d.totalAmount}</td>
                <td>‚Çπ${riderPay}</td>
                <td style="color:orange; font-weight:bold;">${d.status}</td>
                <td>
                    <input type="text" id="r-${doc.id}" style="width:80px" value="${d.assignedTo || ''}">
                    <button onclick="assign('${doc.id}')">Update</button>
                </td>
                <td><button onclick="if(confirm('Delete?')) db.collection('orders').doc('${doc.id}').delete()" style="color:red;">‚ùå</button></td>
            </tr>`;
        });
        document.getElementById('sales').innerText = "‚Çπ" + sales;
        document.getElementById('count').innerText = count;
        document.getElementById('profit').innerText = "‚Çπ" + (sales * 0.15).toFixed(0); // 15% calculation
    });

    function assign(id) {
        const r = document.getElementById('r-'+id).value;
        db.collection("orders").doc(id).update({ assignedTo: r, status: "Assigned" });
    }
</script>
</body>
</html>
