<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fast8 Bondhu â€“ Delivery Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f4f4;
    margin:0;
    padding:0;
}
header{
    background:#e63946;
    color:#fff;
    padding:15px;
    text-align:center;
}
.container{
    padding:15px;
}
.card{
    background:#fff;
    padding:15px;
    border-radius:10px;
    margin-bottom:12px;
    box-shadow:0 2px 6px rgba(0,0,0,.1);
}
button{
    padding:8px 12px;
    border:none;
    border-radius:6px;
    background:#e63946;
    color:#fff;
    cursor:pointer;
    margin-top:8px;
}
select{
    width:100%;
    padding:8px;
    margin-top:6px;
}
input{
    width:100%;
    padding:10px;
    margin-bottom:10px;
}
.hidden{display:none;}
</style>
</head>

<body>

<header>
<h2>ðŸšš Delivery Panel</h2>
</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox">
    <h3>Delivery Login</h3>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
</div>

<!-- ORDERS -->
<div id="ordersBox" class="hidden">
    <h3>Assigned Orders</h3>
    <div id="ordersList"></div>
    <button onclick="logout()">Logout</button>
</div>

</div>

<script>
/* ðŸ”¥ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyC2zOBXJZenhCezfVNa4WdAYNFgG_ivb98",
  authDomain: "fast8bondhu-6f6a6.firebaseapp.com",
  projectId: "fast8bondhu-6f6a6",
  storageBucket: "fast8bondhu-6f6a6.firebasestorage.app",
  messagingSenderId: "796987979513",
  appId: "1:796987979513:web:0befb96daba208f1bd5428"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* ðŸ” Auth */
auth.onAuthStateChanged(user=>{
    if(user){
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("ordersBox").classList.remove("hidden");
        loadOrders(user.uid);
    }
});

/* Login */
function login(){
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, pass)
    .catch(err=>alert(err.message));
}

/* Logout */
function logout(){
    auth.signOut();
    location.reload();
}

/* Load Assigned Orders */
function loadOrders(uid){
    db.collection("orders")
    .where("deliveryBoyId","==",uid)
    .onSnapshot(snap=>{
        const list = document.getElementById("ordersList");
        list.innerHTML="";
        if(snap.empty){
            list.innerHTML="<p>No assigned orders</p>";
            return;
        }
        snap.forEach(doc=>{
            const o = doc.data();
            list.innerHTML+=`
            <div class="card">
                <b>Order:</b> ${doc.id}<br>
                <b>Name:</b> ${o.customerName}<br>
                <b>Phone:</b> ${o.customerPhone}<br>
                <b>Address:</b> ${o.customerAddress}<br>
                <b>Total:</b> â‚¹${o.totalAmount}<br>

                <select onchange="updateStatus('${doc.id}',this.value)">
                    <option ${o.status=="Assigned"?"selected":""}>Assigned</option>
                    <option ${o.status=="Picked"?"selected":""}>Picked</option>
                    <option ${o.status=="On The Way"?"selected":""}>On The Way</option>
                    <option ${o.status=="Delivered"?"selected":""}>Delivered</option>
                </select>
            </div>
            `;
        });
    });
}

/* Update Order Status */
function updateStatus(orderId,status){
    db.collection("orders").doc(orderId).update({
        status: status
    });
}
</script>

</body>
</html>