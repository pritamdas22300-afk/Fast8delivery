<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast8Bondhu â€“ Order Fresh</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
body{background:#f6f7fb;padding-bottom:70px}
header{background:#e63946;color:#fff;padding:18px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}
.card{background:#fff;border-radius:14px;padding:12px;text-align:center;position:relative}
.badge{position:absolute;top:8px;right:8px;font-size:10px;padding:3px 7px;border-radius:10px;background:#eee}
.btn{background:#ffb703;border:none;border-radius:10px;padding:10px;font-weight:700;width:100%}
.cart{position:fixed;bottom:0;width:100%;background:#fff;border-radius:25px 25px 0 0;
padding:20px;transform:translateY(100%);transition:.3s;z-index:1000}
.cart.active{transform:translateY(0)}
input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
.bottom{position:fixed;bottom:0;width:100%;background:#fff;display:flex;justify-content:space-around;padding:10px 0;border-top:1px solid #ddd}
.nav{font-size:11px;text-align:center;color:#666}
.nav.active{color:#e63946}
.hidden{display:none}
</style>
</head>

<body>

<header>
<div>
<h3>Fast8Bondhu</h3>
<small>Fast delivery</small>
</div>
<div onclick="toggleCart()">
<i class="fa fa-shopping-cart"></i>
<span id="cartCount">0</span>
</div>
</header>

<!-- SHOP -->
<div id="page-shop" class="grid"></div>

<!-- ORDERS -->
<div id="page-orders" class="hidden" style="padding:15px">
<h3>My Orders</h3>
<div id="ordersBox"></div>
</div>

<!-- CART -->
<div class="cart" id="cartBox">
<h3>Checkout</h3>
<div id="cartItems"></div>

<input id="name" placeholder="Name">
<input id="phone" placeholder="Phone">
<input id="address" placeholder="Address">

<b>Total: â‚¹<span id="total">0</span></b><br><br>
<button class="btn" onclick="placeOrder()">CONFIRM (COD)</button>
<button onclick="toggleCart()" style="margin-top:10px;width:100%;border:none;background:none">Close</button>
</div>

<!-- BOTTOM -->
<div class="bottom">
<div class="nav active" onclick="show('shop')"><i class="fa fa-store"></i><br>Shop</div>
<div class="nav" onclick="show('orders')"><i class="fa fa-receipt"></i><br>Orders</div>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG (CHANGE THIS) */
firebase.initializeApp({
 apiKey:"YOUR_API_KEY",
 authDomain:"YOUR_PROJECT.firebaseapp.com",
 projectId:"YOUR_PROJECT"
});
const db=firebase.firestore();
const auth=firebase.auth();

/* STATE */
let cart=[],products=[],user=null;
const DELIVERY=30;

/* AUTH */
auth.onAuthStateChanged(u=>{
 if(!u) auth.signInAnonymously();
 else{user=u;loadProducts();loadOrders();}
});

/* LOAD PRODUCTS */
function loadProducts(){
 db.collection("products").onSnapshot(s=>{
  const box=document.getElementById("page-shop");
  box.innerHTML="";products=[];
  s.forEach(d=>{
   const p=d.data();p.id=d.id;products.push(p);
   box.innerHTML+=`
   <div class="card ${p.stock<=0?'hidden':''}">
    <span class="badge">${p.stock} left</span>
    <h4>${p.name}</h4>
    <b>â‚¹${p.price}</b><br><br>
    <button class="btn" onclick="add('${p.id}')">Add</button>
   </div>`;
  });
 });
}

/* CART */
function add(id){
 const p=products.find(x=>x.id==id);
 const c=cart.find(x=>x.id==id);
 if(c){if(c.qty>=p.stock)return alert("Stock limit");c.qty++}
 else cart.push({...p,qty:1});
 updateCart();
}
function updateCart(){
 let total=DELIVERY,count=0;
 document.getElementById("cartItems").innerHTML=
 cart.map(i=>{
  total+=i.price*i.qty;count+=i.qty;
  return `<div>${i.name} x${i.qty}</div>`;
 }).join("");
 document.getElementById("total").innerText=total;
 document.getElementById("cartCount").innerText=count;
}
function toggleCart(){document.getElementById("cartBox").classList.toggle("active")}

/* PLACE ORDER (TRANSACTION SAFE) */
async function placeOrder(){
 const n=name.value,p=phone.value,a=address.value;
 if(!n||!p||!a||cart.length==0) return alert("Fill all");
 await db.runTransaction(async t=>{
  for(let i of cart){
   const r=db.collection("products").doc(i.id);
   const d=await t.get(r);
   if(d.data().stock<i.qty) throw "Out of stock";
   t.update(r,{stock:firebase.firestore.FieldValue.increment(-i.qty)});
  }
  t.set(db.collection("orders").doc(),{
   userId:user.uid,
   customerName:n,
   phone:p,address:a,
   items:cart,
   totalAmount:cart.reduce((s,i)=>s+i.price*i.qty,0)+DELIVERY,
   status:"Pending",
   created:firebase.firestore.FieldValue.serverTimestamp()
  });
 });
 alert("Order placed");
 cart=[];updateCart();toggleCart();show('orders');
}

/* ORDERS */
function loadOrders(){
 db.collection("orders").where("userId","==",user.uid)
 .onSnapshot(s=>{
  const b=document.getElementById("ordersBox");b.innerHTML="";
  s.forEach(d=>{
   const o=d.data();
   b.innerHTML+=`
   <div class="card">
    <b>#${d.id.slice(0,6)}</b><br>
    Status: ${o.status}<br>
    Total: â‚¹${o.totalAmount}
   </div>`;
  });
 });
}

/* NAV */
function show(p){
 page-shop.classList.toggle("hidden",p!="shop");
 page-orders.classList.toggle("hidden",p!="orders");
 document.querySelectorAll(".nav").forEach(n=>n.classList.remove("active"));
 document.querySelector(`.nav[onclick*='${p}']`).classList.add("active");
}
</script>
</body>
</html>