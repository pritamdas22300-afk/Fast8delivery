<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast8 Bondhu – Order Fresh</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --red:#e63946; --yellow:#ffb703; --dark:#1d3557; --light:#f8f9fa;
}
*{box-sizing:border-box;font-family:Poppins;margin:0;padding:0}
body{background:var(--light);padding-bottom:70px;color:var(--dark)}
header{background:var(--red);color:#fff;padding:18px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:10}
.product-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:15px}
.card{background:#fff;border-radius:14px;padding:12px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,.05)}
.card.out{opacity:.5;pointer-events:none}
.price{color:var(--red);font-weight:700;margin:5px 0}
.btn{background:var(--yellow);border:none;border-radius:10px;padding:8px;width:100%;font-weight:700}
.cart{position:fixed;bottom:0;width:100%;background:#fff;border-radius:25px 25px 0 0;padding:20px;transform:translateY(100%);transition:.3s;z-index:20}
.cart.active{transform:translateY(0)}
input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd}
.bottom-nav{position:fixed;bottom:0;width:100%;background:#fff;display:flex;justify-content:space-around;padding:10px 0;border-top:1px solid #eee}
.nav{font-size:12px;color:#888;text-decoration:none;text-align:center}
.nav.active{color:var(--red)}
.hidden{display:none}
</style>
</head>

<body>

<header>
  <div>
    <h3>Fast8 Bondhu</h3>
    <small id="status">Connecting...</small>
  </div>
  <div onclick="toggleCart()">
    <i class="fas fa-shopping-cart"></i>
    <span id="cart-count">0</span>
  </div>
</header>

<!-- HOME -->
<div id="home">
  <div class="product-grid" id="products"></div>
</div>

<!-- ORDERS -->
<div id="orders" class="hidden" style="padding:15px">
  <h3>My Orders</h3>
  <div id="orderList"></div>
</div>

<!-- CART -->
<div class="cart" id="cartBox">
  <h3>Your Cart</h3>
  <div id="cartItems"></div>

  <input id="name" placeholder="Your Name">
  <input id="phone" placeholder="Phone">
  <input id="address" placeholder="Address">

  <p><b>Total:</b> ₹<span id="total">0</span></p>
  <button class="btn" onclick="placeOrder()">Confirm COD Order</button>
  <button onclick="toggleCart()" style="margin-top:8px;border:none;background:none;color:#888">Close</button>
</div>

<!-- NAV -->
<div class="bottom-nav">
  <a class="nav active" id="n-home" onclick="show('home')">Shop</a>
  <a class="nav" id="n-orders" onclick="show('orders')">Orders</a>
</div>

<script>
/* ================= FIREBASE CONFIG (YOURS) ================= */
firebase.initializeApp({
  apiKey: "AIzaSyC2zOBXJZenhCezfVNa4WdAYNFgG_ivb98",
  authDomain: "fast8bondhu-6f6a6.firebaseapp.com",
  projectId: "fast8bondhu-6f6a6",
  storageBucket: "fast8bondhu-6f6a6.firebasestorage.app",
  messagingSenderId: "796987979513",
  appId: "1:796987979513:web:0befb96daba208f1bd5428"
});

const db = firebase.firestore();
const auth = firebase.auth();

/* ================= STATE ================= */
let cart = [];
let products = [];
let user = null;
const DELIVERY = 30;

/* ================= AUTH ================= */
auth.signInAnonymously();
auth.onAuthStateChanged(u=>{
  user=u;
  document.getElementById("status").innerText="Ready to order";
  loadProducts();
  listenOrders();
});

/* ================= PRODUCTS ================= */
function loadProducts(){
  db.collection("products").onSnapshot(snap=>{
    const box=document.getElementById("products");
    box.innerHTML=""; products=[];
    snap.forEach(d=>{
      const p=d.data(); p.id=d.id;
      products.push(p);
      const out=p.stock<=0;
      box.innerHTML+=`
      <div class="card ${out?'out':''}">
        <h4>${p.name}</h4>
        <div class="price">₹${p.price}</div>
        <small>${out?'Out of stock':p.stock+' left'}</small>
        <button class="btn" onclick="add('${p.id}')">Add</button>
      </div>`;
    });
  });
}

/* ================= CART ================= */
function add(id){
  const p=products.find(x=>x.id===id);
  const c=cart.find(x=>x.id===id);
  if(c){ if(c.qty>=p.stock) return alert("No stock"); c.qty++; }
  else cart.push({...p,qty:1});
  renderCart();
}
function renderCart(){
  let t=0,c=0;
  document.getElementById("cartItems").innerHTML=
    cart.map(i=>{
      t+=i.price*i.qty; c+=i.qty;
      return `<p>${i.name} x${i.qty}</p>`;
    }).join("");
  document.getElementById("total").innerText=t+DELIVERY;
  document.getElementById("cart-count").innerText=c;
}
function toggleCart(){document.getElementById("cartBox").classList.toggle("active");}

/* ================= ORDER ================= */
async function placeOrder(){
  if(!cart.length) return alert("Empty cart");
  const name=nameInput.value,phone=phoneInput.value,address=addressInput.value;
  if(!name||!phone||!address) return alert("Fill details");

  await db.runTransaction(async t=>{
    for(const i of cart){
      const ref=db.collection("products").doc(i.id);
      const s=await t.get(ref);
      if(!s.exists||s.data().stock<i.qty) throw "Out of stock";
      t.update(ref,{stock:firebase.firestore.FieldValue.increment(-i.qty)});
    }
    t.set(db.collection("orders").doc(),{
      userId:user.uid,
      customerName:name,
      customerPhone:phone,
      customerAddress:address,
      items:cart,
      totalAmount:cart.reduce((a,b)=>a+b.price*b.qty,0)+DELIVERY,
      status:"Pending",
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
  });

  cart=[];renderCart();toggleCart();show("orders");
  alert("Order placed");
}

/* ================= TRACK ================= */
function listenOrders(){
  db.collection("orders")
    .where("userId","==",user.uid)
    .orderBy("createdAt","desc")
    .onSnapshot(s=>{
      const o=document.getElementById("orderList");
      o.innerHTML="";
      s.forEach(d=>{
        const x=d.data();
        o.innerHTML+=`<div class="card"><b>₹${x.totalAmount}</b><br>Status: ${x.status}</div>`;
      });
    });
}

/* ================= UI ================= */
function show(p){
  home.classList.add("hidden");
  orders.classList.add("hidden");
  document.getElementById(p).classList.remove("hidden");
  n_home.classList.remove("active"); n_orders.classList.remove("active");
  document.getElementById("n-"+p).classList.add("active");
}
</script>
</body>
</html>